{"ast":null,"code":"var _jsxFileName = \"/Users/E113938/Library/CloudStorage/OneDrive-RMITUniversity/My Mac Folders/2025/FILTER Project/FILTER/Map Dashboard/Map Demonstrator/src/components/map.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport maplibregl from 'maplibre-gl';\nimport 'maplibre-gl/dist/maplibre-gl.css';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\nimport indicatorMetadata from './indicatorMetadata';\nimport bbox from '@turf/bbox'; // New import for bounding box calculation\n\n// --- LLM API Setup ---\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);\n\n// --- START: INTERACTIVE DESCRIPTION COMPONENT ---\n// This component finds and styles specified keywords in a block of text.\nconst InteractiveDescription = ({\n  text,\n  keywords,\n  colors,\n  onKeywordHover\n}) => {\n  if (!text) return null;\n\n  // Create a regex that matches either a keyword or a bolded section.\n  const regex = new RegExp(`(${keywords.join('|')}|\\\\*\\\\*.+?\\\\*\\\\*)`, 'gi');\n  const parts = text.split(regex).filter(part => part);\n  return /*#__PURE__*/_jsxDEV(\"p\", {\n    style: {\n      fontSize: '0.95rem',\n      color: '#6c757d',\n      lineHeight: 1.6\n    },\n    children: parts.map((part, index) => {\n      // First, check if the part is a bolded section.\n      if (part.startsWith('**') && part.endsWith('**')) {\n        return /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: part.substring(2, part.length - 2)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 25,\n          columnNumber: 18\n        }, this);\n      }\n\n      // Next, check if the part is an interactive keyword.\n      const originalKeyword = keywords.find(kw => kw.toLowerCase() === part.toLowerCase());\n      if (originalKeyword) {\n        return /*#__PURE__*/_jsxDEV(\"strong\", {\n          style: {\n            color: colors[originalKeyword] || '#000',\n            cursor: 'pointer',\n            fontWeight: 'bold',\n            padding: '2px 0',\n            borderBottom: `2px solid ${colors[originalKeyword] || '#000'}`\n          },\n          onMouseEnter: () => onKeywordHover(originalKeyword),\n          onMouseLeave: () => onKeywordHover(null),\n          children: part\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 32,\n          columnNumber: 13\n        }, this);\n      }\n\n      // Otherwise, it's just a regular piece of text.\n      return /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: part\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 16\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 21,\n    columnNumber: 5\n  }, this);\n};\n// --- END: INTERACTIVE DESCRIPTION COMPONENT ---\n\n// --- START: LEGEND COMPONENT ---\n_c = InteractiveDescription;\nconst Legend = ({\n  title,\n  items\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'absolute',\n      bottom: '1rem',\n      right: '0rem',\n      backgroundColor: 'white',\n      padding: '1rem',\n      borderRadius: '0.5rem',\n      boxShadow: '0 4px 6px rgba(0,0,0,0.1)',\n      zIndex: 10,\n      width: '240px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      style: {\n        margin: '0 0 0.5rem 0',\n        fontWeight: 'bold'\n      },\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), items.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        marginBottom: '0.25rem'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          backgroundColor: item.color,\n          width: '18px',\n          height: '18px',\n          display: 'inline-block',\n          marginRight: '0.5rem',\n          border: '1px solid #ccc'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: item.label\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }, this)]\n    }, index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 5\n  }, this);\n};\n// --- END: LEGEND COMPONENT ---\n\n// --- START: MAP COMPONENT ---\n_c2 = Legend;\nexport default function Map() {\n  _s();\n  const mapContainer = useRef(null);\n  const map = useRef(null);\n  const descriptionCache = useRef({});\n\n  // Definitions for interactive text highlighting\n  const PRECINCT_NAMES = ['Montague', 'Sandridge', 'Lorimer', 'Wirraway', 'Employment Precinct'];\n  const PRECINCT_COLORS = {\n    'Montague': '#3498db',\n    'Sandridge': '#e74c3c',\n    'Lorimer': '#2ecc71',\n    'Wirraway': '#f39c12',\n    'Employment Precinct': '#9b59b6'\n  };\n\n  // --- STATE MANAGEMENT ---\n  const [searchText, setSearchText] = useState('');\n  const [indicators, setIndicators] = useState([]);\n  const [selectedIndicator, setSelectedIndicator] = useState(null);\n  const [showIndicators, setShowIndicators] = useState(false);\n  const [panelFocus, setPanelFocus] = useState(null);\n  const [dynamicDescription, setDynamicDescription] = useState('');\n  const [isDescriptionLoading, setIsDescriptionLoading] = useState(false);\n  const [textHoveredPrecinct, setTextHoveredPrecinct] = useState(null);\n\n  // Panel widths for map padding\n  const leftPanelWidth = 288;\n  const rightPanelWidth = 175;\n\n  // --- DATA DEFINITIONS ---\n  const legendData = {\n    'Diversity of Education Qualification': {\n      title: 'Residents with any qualification (Total)',\n      items: [{\n        color: '#fee5d9',\n        label: '0 - 100'\n      }, {\n        color: '#fcbba1',\n        label: '101 - 200'\n      }, {\n        color: '#fc9272',\n        label: '201 - 300'\n      }, {\n        color: '#fb6a4a',\n        label: '301 - 400'\n      }, {\n        color: '#ef3b2c',\n        label: '401 - 500'\n      }, {\n        color: '#cb181d',\n        label: '> 500'\n      }]\n    },\n    'Diversity of Income': {\n      title: 'Residents with any income level (Total)',\n      items: [{\n        color: '#fcfbfd',\n        label: '0 - 100'\n      }, {\n        color: '#efedf5',\n        label: '101 - 200'\n      }, {\n        color: '#dadaeb',\n        label: '201 - 300'\n      }, {\n        color: '#bcbddc',\n        label: '301 - 400'\n      }, {\n        color: '#9e9ac8',\n        label: '401 - 500'\n      }, {\n        color: '#807dba',\n        label: '501 - 600'\n      }, {\n        color: '#6a51a3',\n        label: '601 - 700'\n      }, {\n        color: '#54278f',\n        label: '701 - 800'\n      }, {\n        color: '#3f007d',\n        label: '> 800'\n      }]\n    },\n    'Diversity of Occupations': {\n      title: 'Residents with any occupations (Total)',\n      items: [{\n        color: '#f7fbff',\n        label: '0 - 100'\n      }, {\n        color: '#deebf7',\n        label: '101 - 200'\n      }, {\n        color: '#c6dbef',\n        label: '201 - 300'\n      }, {\n        color: '#9ecae1',\n        label: '301 - 400'\n      }, {\n        color: '#6baed6',\n        label: '401 - 500'\n      }, {\n        color: '#4292c6',\n        label: '501 - 600'\n      }, {\n        color: '#2171b5',\n        label: '601 - 700'\n      }, {\n        color: '#08519c',\n        label: '701 - 800'\n      }, {\n        color: '#08306b',\n        label: '> 800'\n      }]\n    }\n  };\n  const indicatorConfig = {\n    'Diversity of Education Qualification': {\n      path: '/data/education-fb-sa1.geojson',\n      property: 'Education-VIC_Total'\n    },\n    'Diversity of Income': {\n      path: '/data/income-fb-sa1.geojson',\n      property: 'Income-VIC1_Total'\n    },\n    'Diversity of Occupations': {\n      path: '/data/occupation-fb-sa1.geojson',\n      property: 'Occupation-VIC_Total'\n    }\n  };\n\n  // --- HOOKS for Map Lifecycle & Effects ---\n\n  // Main Map Initialization\n  useEffect(() => {\n    if (map.current || !mapContainer.current) return;\n    map.current = new maplibregl.Map({\n      container: mapContainer.current,\n      style: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',\n      scrollZoom: false,\n      boxZoom: false,\n      dragRotate: false,\n      dragPan: false,\n      keyboard: false,\n      doubleClickZoom: false,\n      touchZoomRotate: false\n    });\n    map.current.on('error', e => console.error('A map error occurred:', e.error ? e.error.message : 'Unknown error'));\n    map.current.on('load', () => {\n      adjustMapBounds();\n      const sources = [{\n        name: 'base-outline',\n        path: '/data/fb-sa1-2021-WGS84-boundary.geojson'\n      }, {\n        name: 'employment',\n        path: '/data/employment-fb-sa1.geojson'\n      }, {\n        name: 'education',\n        path: '/data/education-fb-sa1.geojson'\n      }, {\n        name: 'pob',\n        path: '/data/POB-fb-sa1.geojson'\n      }, {\n        name: 'income',\n        path: '/data/income-fb-sa1.geojson'\n      }, {\n        name: 'occupation',\n        path: '/data/occupation-fb-sa1.geojson'\n      }, {\n        name: 'precincts',\n        path: '/data/fb-precincts-official-boundary.geojson'\n      }];\n      sources.forEach(s => map.current.addSource(`${s.name}-data-source`, {\n        type: 'geojson',\n        data: s.path\n      }));\n      const layers = [{\n        id: 'diversity-of-education-qualification-layer',\n        indicatorName: 'Diversity of Education Qualification',\n        source: 'education-data-source',\n        property: indicatorConfig['Diversity of Education Qualification'].property,\n        colors: legendData['Diversity of Education Qualification'].items.map(i => i.color),\n        stops: [0, 100, 200, 300, 400, 500]\n      }, {\n        id: 'diversity-of-income-layer',\n        indicatorName: 'Diversity of Income',\n        source: 'income-data-source',\n        property: indicatorConfig['Diversity of Income'].property,\n        colors: legendData['Diversity of Income'].items.map(i => i.color),\n        stops: [0, 100, 200, 300, 400, 500, 600, 700, 800]\n      }, {\n        id: 'diversity-of-occupations-layer',\n        indicatorName: 'Diversity of Occupations',\n        source: 'occupation-data-source',\n        property: indicatorConfig['Diversity of Occupations'].property,\n        colors: legendData['Diversity of Occupations'].items.map(i => i.color),\n        stops: [0, 100, 200, 300, 400, 500, 600, 700, 800]\n      }];\n      layers.forEach(layer => {\n        const colorStops = layer.stops.flatMap((stop, i) => [stop, layer.colors[i] || layer.colors[layer.colors.length - 1]]);\n        map.current.addLayer({\n          id: layer.id,\n          type: 'fill',\n          source: layer.source,\n          layout: {\n            visibility: 'none'\n          },\n          paint: {\n            'fill-color': ['interpolate', ['linear'], ['to-number', ['get', layer.property]], ...colorStops],\n            'fill-opacity': 0.6\n          }\n        });\n        map.current.on('click', layer.id, e => {\n          const feature = e.features[0];\n          if (feature) {\n            const regionName = feature.properties['SA1_CODE21'];\n            const value = feature.properties[layer.property];\n            const formattedValue = !isNaN(value) ? Number(value).toLocaleString() : 'N/A';\n          }\n        });\n        map.current.on('mouseenter', layer.id, () => {\n          map.current.getCanvas().style.cursor = 'pointer';\n        });\n        map.current.on('mouseleave', layer.id, () => {\n          map.current.getCanvas().style.cursor = '';\n        });\n      });\n      map.current.addLayer({\n        id: 'base-outline-layer',\n        type: 'line',\n        source: 'base-outline-data-source',\n        paint: {\n          'line-color': '#444',\n          'line-width': 0.2\n        }\n      });\n      map.current.addLayer({\n        id: 'precincts-fill-layer',\n        type: 'fill',\n        source: 'precincts-data-source',\n        paint: {\n          'fill-color': '#ffffffff',\n          'fill-opacity': 0.15\n        }\n      });\n      map.current.addLayer({\n        id: 'precincts-shadow-layer',\n        type: 'line',\n        source: 'precincts-data-source',\n        paint: {\n          'line-color': 'rgba(0, 0, 0, 0.4)',\n          'line-width': 7,\n          'line-translate': [2, 2],\n          'line-blur': 4\n        }\n      });\n      map.current.addLayer({\n        id: 'precincts-outline-layer',\n        type: 'line',\n        source: 'precincts-data-source',\n        paint: {\n          'line-color': '#0868ac',\n          'line-width': 2.5,\n          'line-opacity': 0.9\n        }\n      });\n      map.current.on('click', 'precincts-fill-layer', e => {\n        const feature = e.features[0];\n        if (!feature || !feature.properties.name) return;\n        const precinctName = feature.properties.name;\n        setPanelFocus({\n          type: 'precinct',\n          name: precinctName\n        });\n        setTextHoveredPrecinct(null);\n      });\n      map.current.on('mouseenter', 'precincts-fill-layer', () => {\n        map.current.getCanvas().style.cursor = 'pointer';\n      });\n      map.current.on('mouseleave', 'precincts-fill-layer', () => {\n        map.current.getCanvas().style.cursor = '';\n      });\n    });\n    return () => {\n      if (map.current) {\n        map.current.remove();\n        map.current = null;\n      }\n    };\n  }, []);\n\n  // UPDATED: Adjust map bounds on load (and for resets)\n  const adjustMapBounds = (duration = 2000) => {\n    if (!map.current) return;\n    const bounds = [[144.890, -37.850], [144.948, -37.816]];\n    map.current.fitBounds(bounds, {\n      padding: {\n        top: 20,\n        bottom: 20,\n        left: leftPanelWidth,\n        right: rightPanelWidth\n      },\n      duration: duration,\n      essential: true\n    });\n  };\n\n  // UPDATED: Adjust map bounds on window resize\n  useEffect(() => {\n    function debounce(fn, ms) {\n      let timer;\n      return function (...args) {\n        clearTimeout(timer);\n        timer = setTimeout(() => {\n          fn.apply(this, args);\n        }, ms);\n      };\n    }\n    const debouncedAdjustBounds = () => {\n      adjustMapBounds(0); // Pass 0 for an instant adjustment\n    };\n    const debouncedResizeListener = debounce(debouncedAdjustBounds, 150);\n    window.addEventListener('resize', debouncedResizeListener);\n    return () => window.removeEventListener('resize', debouncedResizeListener);\n  }, []);\n\n  // Toggle visibility of indicator layers\n  useEffect(() => {\n    if (!map.current || !map.current.isStyleLoaded()) return;\n    const allLayerIds = ['diversity-of-education-qualification-layer', 'diversity-of-income-layer', 'diversity-of-occupations-layer'];\n    const selectedLayerId = selectedIndicator ? `${selectedIndicator.toLowerCase().replace(/ /g, '-')}-layer` : null;\n    if (map.current.getLayer('base-outline-layer')) {\n      map.current.setLayoutProperty('base-outline-layer', 'visibility', selectedIndicator ? 'visible' : 'none');\n    }\n    allLayerIds.forEach(layerId => {\n      if (map.current.getLayer(layerId)) {\n        map.current.setLayoutProperty(layerId, 'visibility', layerId === selectedLayerId ? 'visible' : 'none');\n      }\n    });\n  }, [selectedIndicator]);\n\n  // Generate LLM description when panel focus changes\n  useEffect(() => {\n    if (!panelFocus) {\n      setDynamicDescription('');\n      setIsDescriptionLoading(false);\n      return;\n    }\n    const generateDescription = async () => {\n      setIsDescriptionLoading(true);\n      setDynamicDescription('');\n      const {\n        type,\n        name\n      } = panelFocus;\n      const cacheKey = `${type}_${name}`;\n      if (descriptionCache.current[cacheKey]) {\n        setDynamicDescription(descriptionCache.current[cacheKey]);\n        setIsDescriptionLoading(false);\n        return;\n      }\n      try {\n        let prompt = '';\n        if (type === 'indicator') {\n          const metadata = indicatorMetadata[name];\n          if (!metadata) {\n            throw new Error(`Metadata is missing for the \"${name}\" indicator.`);\n          }\n          prompt = `You are an expert urban data analyst providing a summary for a public-facing dashboard about Melbourne's Fishermans Bend.\nYour task is to generate a clear, descriptive summary for the \"${name}\" indicator based ONLY on the metadata provided below.\n\nUse the following information to structure your response. Present it as a cohesive and easy-to-read paragraph, not as a list. **Crucially, when you incorporate a piece of metadata from the list below into your paragraph, you must make that specific value bold using Markdown (e.g., the goal is **An inclusive community**).**\n\n- **Alignment with Goals**: This indicator aligns with Fishermans Bend's goal of: \"${metadata[\"FB's goals\"]}\".\n- **Measurement Method**: It is measured by this method: \"${metadata[\"Note for measurement\"]}\".\n- **Data Origin**: The data is sourced from \"${metadata[\"Data sources\"]}\".\n- **Geographic Coverage**: The data's spatial extent is \"${metadata[\"Spatial extent\"]}\", presented at a \"${metadata[\"Spatial scale\"]}\" level.\n- **Timeliness**: The data is updated every \"${metadata[\"Update frequency\"]}\". The current version is from \"${metadata[\"Temporal currency\"]}\", and the historical data available covers the period \"${metadata[\"Temporal extent\"]}\".\n\nSynthesize this information into an engaging and informative paragraph of about 70-100 words. Start by explaining what this indicator is and why it's important for Fishermans Bend's goals. Then, provide context about the data itself. Remember to make all the specific metadata values bold in your final output. Do not invent or infer any data values, statistics, or trends.`;\n        } else if (type === 'precinct') {\n          prompt = `You are a concise urban planning analyst. Write a short, engaging summary (around 60-80 words) about the \"${name}\" precinct within Melbourne's Fishermans Bend. Describe its key vision or main characteristics. If relevant, mention its relationship to the other precincts like Montague, Sandridge, and the Employment Precinct.`;\n        }\n        if (prompt) {\n          const model = genAI.getGenerativeModel({\n            model: \"gemini-1.5-flash-latest\"\n          });\n          const result = await model.generateContent(prompt);\n          const text = result.response.text();\n          descriptionCache.current[cacheKey] = text;\n          setDynamicDescription(text);\n        }\n      } catch (error) {\n        console.error(`Error generating description for ${name}:`, error);\n        const errorMessage = error.message.includes('429') ? 'Daily free API quota exceeded. Please try again tomorrow or upgrade to a paid plan.' : `An error occurred while generating the description: ${error.message}`;\n        setDynamicDescription(errorMessage);\n      } finally {\n        setIsDescriptionLoading(false);\n      }\n    };\n    generateDescription();\n  }, [panelFocus]);\n\n  // Update map visual style when a precinct is highlighted from text\n  useEffect(() => {\n    if (!map.current || !map.current.isStyleLoaded()) return;\n    if (textHoveredPrecinct) {\n      const fillColorExpression = ['case', ['==', ['get', 'name'], textHoveredPrecinct], PRECINCT_COLORS[textHoveredPrecinct], '#ffffffff'];\n      const fillOpacityExpression = ['case', ['==', ['get', 'name'], textHoveredPrecinct], 0.6, 0.15];\n      const outlineColorExpression = ['case', ['==', ['get', 'name'], textHoveredPrecinct], PRECINCT_COLORS[textHoveredPrecinct], '#0868ac'];\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-color', fillColorExpression);\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-opacity', fillOpacityExpression);\n      map.current.setPaintProperty('precincts-outline-layer', 'line-color', outlineColorExpression);\n    } else {\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-color', '#ffffffff');\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-opacity', 0.15);\n      map.current.setPaintProperty('precincts-outline-layer', 'line-color', '#0868ac');\n    }\n  }, [textHoveredPrecinct, PRECINCT_COLORS]);\n\n  // --- UI HANDLERS ---\n  const handleSearchClick = () => {\n    setIndicators(['Diversity of Education Qualification', 'Diversity of Income', 'Diversity of Occupations']);\n    setShowIndicators(true);\n  };\n\n  // UPDATED: Handles selecting/deselecting indicators and resets map view\n  const handleIndicatorSelect = indicator => {\n    const isCurrentlySelected = selectedIndicator === indicator;\n    const newIndicator = isCurrentlySelected ? null : indicator;\n\n    // If an indicator is being deselected, reset the map view\n    if (!newIndicator) {\n      adjustMapBounds(800);\n    }\n    setSelectedIndicator(newIndicator);\n    setPanelFocus(newIndicator ? {\n      type: 'indicator',\n      name: newIndicator\n    } : null);\n    setTextHoveredPrecinct(null);\n  };\n\n  // UPDATED: Handles zooming the map on text hover\n  const handlePrecinctHover = precinctName => {\n    setTextHoveredPrecinct(precinctName);\n    if (!map.current || !map.current.isStyleLoaded()) return;\n\n    // If hovering OVER a precinct name (onMouseEnter)\n    if (precinctName) {\n      const features = map.current.querySourceFeatures('precincts-data-source', {\n        filter: ['==', ['get', 'name'], precinctName]\n      });\n      if (features.length > 0) {\n        const feature = features[0];\n        const precinctBbox = bbox(feature); // Gets the hovered precinct's bounding box\n\n        // --- Start of Dynamic Padding Calculation ---\n\n        // 1. Define the overall map bounds and desired padding range in pixels.\n        //    You can tweak min/max padding to adjust the zoom \"feel\".\n        const fullMapBbox = [144.890, -37.850, 144.948, -37.816];\n        const minPadding = 40; // Padding for the largest precincts (e.g., Employment Precinct).\n        const maxPadding = 150; // Padding for the smallest precincts (e.g., Lorimer).\n\n        // 2. Calculate the dimensions of the precinct and the full map view.\n        const precinctWidth = precinctBbox[2] - precinctBbox[0];\n        const precinctHeight = precinctBbox[3] - precinctBbox[1];\n        const fullMapWidth = fullMapBbox[2] - fullMapBbox[0];\n        const fullMapHeight = fullMapBbox[3] - fullMapBbox[1];\n\n        // 3. Determine how large the precinct is relative to the full map.\n        //    We use the larger of its two dimensions (width or height) for the calculation.\n        const widthRatio = precinctWidth / fullMapWidth;\n        const heightRatio = precinctHeight / fullMapHeight;\n        const maxRatio = Math.max(widthRatio, heightRatio);\n\n        // 4. Calculate the dynamic padding. A larger precinct (higher maxRatio) gets less padding.\n        //    This formula scales the padding inversely with the precinct's relative size.\n        const paddingRange = maxPadding - minPadding;\n        let dynamicPadding = maxPadding - maxRatio * paddingRange;\n\n        // 5. Ensure the calculated padding doesn't go below our defined minimum.\n        dynamicPadding = Math.max(dynamicPadding, minPadding);\n\n        // --- End of Dynamic Padding Calculation ---\n\n        // Animate the map to fit the precinct's bounding box with the new dynamic padding\n        map.current.fitBounds(precinctBbox, {\n          padding: {\n            top: dynamicPadding,\n            bottom: dynamicPadding,\n            left: leftPanelWidth + dynamicPadding,\n            // Adds panel width to our dynamic padding\n            right: rightPanelWidth + dynamicPadding // Adds panel width to our dynamic padding\n          },\n          duration: 800,\n          essential: true\n        });\n      }\n    } else {\n      // If the mouse LEAVES the text (onMouseLeave), reset the map's view\n      adjustMapBounds(800);\n    }\n  };\n\n  // --- RENDER METHOD ---\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      width: '100%',\n      height: 'calc(100vh - 78px)'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative',\n        flex: 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: mapContainer,\n        style: {\n          position: 'absolute',\n          width: '100%',\n          height: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          top: '1rem',\n          left: '1rem',\n          backgroundColor: 'white',\n          padding: '1rem',\n          borderRadius: '0.5rem',\n          boxShadow: '0 4px 6px rgba(0,0,0,0.1)',\n          width: '288px',\n          zIndex: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            fontSize: '1.125rem',\n            fontWeight: 'bold',\n            marginBottom: '1rem'\n          },\n          children: \"I'm interested in ...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '0.75rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: searchText,\n            onChange: e => setSearchText(e.target.value),\n            placeholder: \"e.g., 'jobs' or 'housing'\",\n            style: {\n              padding: '0.5rem',\n              border: '1px solid #D1D5DB',\n              borderRadius: '0.375rem',\n              outline: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleSearchClick,\n            style: {\n              backgroundColor: '#2563EB',\n              color: 'white',\n              fontWeight: 600,\n              padding: '0.5rem 1rem',\n              borderRadius: '0.375rem',\n              border: 'none',\n              cursor: 'pointer'\n            },\n            children: \"Search\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 11\n        }, this), showIndicators && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: '1rem',\n            paddingTop: '1rem',\n            borderTop: '1px solid #E5E7EB'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            style: {\n              fontWeight: 600,\n              color: '#1F2937',\n              marginBottom: '0.5rem'\n            },\n            children: \"Suggested Indicators\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 460,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              flexDirection: 'column',\n              gap: '0.5rem'\n            },\n            children: indicators.map(indicator => /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                id: indicator,\n                name: \"indicator\",\n                checked: selectedIndicator === indicator,\n                onChange: () => handleIndicatorSelect(indicator),\n                style: {\n                  height: '1rem',\n                  width: '1rem'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 464,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: indicator,\n                style: {\n                  marginLeft: '0.75rem',\n                  fontSize: '0.875rem',\n                  color: '#374151'\n                },\n                children: indicator\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 465,\n                columnNumber: 21\n              }, this)]\n            }, indicator, true, {\n              fileName: _jsxFileName,\n              lineNumber: 463,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 461,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 452,\n        columnNumber: 9\n      }, this), selectedIndicator && legendData[selectedIndicator] && /*#__PURE__*/_jsxDEV(Legend, {\n        title: legendData[selectedIndicator].title,\n        items: legendData[selectedIndicator].items\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 64\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 450,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '320px',\n        backgroundColor: '#f8f9fa',\n        padding: '1.5rem',\n        borderLeft: '1px solid #dee2e6',\n        overflowY: 'auto'\n      },\n      children: panelFocus ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            fontSize: '1.1rem',\n            fontWeight: 600,\n            color: '#495057',\n            marginBottom: '0.75rem'\n          },\n          children: panelFocus.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 13\n        }, this), isDescriptionLoading ? /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            fontSize: '0.95rem',\n            color: '#6c757d',\n            fontStyle: 'italic'\n          },\n          children: \"\\uD83E\\uDD16 Generating AI description...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(InteractiveDescription, {\n          text: dynamicDescription,\n          keywords: PRECINCT_NAMES,\n          colors: PRECINCT_COLORS,\n          onKeywordHover: handlePrecinctHover\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: '0.95rem',\n          color: '#6c757d',\n          fontStyle: 'italic'\n        },\n        children: \"Select an indicator from the left panel or click on a precinct on the map to see its description.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 475,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 448,\n    columnNumber: 5\n  }, this);\n}\n// --- END: MAP COMPONENT ---\n_s(Map, \"WkFYB2rKJ4hXCyci5cfQJXiykAY=\");\n_c3 = Map;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"InteractiveDescription\");\n$RefreshReg$(_c2, \"Legend\");\n$RefreshReg$(_c3, \"Map\");","map":{"version":3,"names":["React","useState","useEffect","useRef","maplibregl","GoogleGenerativeAI","indicatorMetadata","bbox","jsxDEV","_jsxDEV","genAI","process","env","REACT_APP_GEMINI_API_KEY","InteractiveDescription","text","keywords","colors","onKeywordHover","regex","RegExp","join","parts","split","filter","part","style","fontSize","color","lineHeight","children","map","index","startsWith","endsWith","substring","length","fileName","_jsxFileName","lineNumber","columnNumber","originalKeyword","find","kw","toLowerCase","cursor","fontWeight","padding","borderBottom","onMouseEnter","onMouseLeave","Fragment","_c","Legend","title","items","position","bottom","right","backgroundColor","borderRadius","boxShadow","zIndex","width","margin","item","display","alignItems","marginBottom","height","marginRight","border","label","_c2","Map","_s","mapContainer","descriptionCache","PRECINCT_NAMES","PRECINCT_COLORS","searchText","setSearchText","indicators","setIndicators","selectedIndicator","setSelectedIndicator","showIndicators","setShowIndicators","panelFocus","setPanelFocus","dynamicDescription","setDynamicDescription","isDescriptionLoading","setIsDescriptionLoading","textHoveredPrecinct","setTextHoveredPrecinct","leftPanelWidth","rightPanelWidth","legendData","indicatorConfig","path","property","current","container","scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","on","e","console","error","message","adjustMapBounds","sources","name","forEach","s","addSource","type","data","layers","id","indicatorName","source","i","stops","layer","colorStops","flatMap","stop","addLayer","layout","visibility","paint","feature","features","regionName","properties","value","formattedValue","isNaN","Number","toLocaleString","getCanvas","precinctName","remove","duration","bounds","fitBounds","top","left","essential","debounce","fn","ms","timer","args","clearTimeout","setTimeout","apply","debouncedAdjustBounds","debouncedResizeListener","window","addEventListener","removeEventListener","isStyleLoaded","allLayerIds","selectedLayerId","replace","getLayer","setLayoutProperty","layerId","generateDescription","cacheKey","prompt","metadata","Error","model","getGenerativeModel","result","generateContent","response","errorMessage","includes","fillColorExpression","fillOpacityExpression","outlineColorExpression","setPaintProperty","handleSearchClick","handleIndicatorSelect","indicator","isCurrentlySelected","newIndicator","handlePrecinctHover","querySourceFeatures","precinctBbox","fullMapBbox","minPadding","maxPadding","precinctWidth","precinctHeight","fullMapWidth","fullMapHeight","widthRatio","heightRatio","maxRatio","Math","max","paddingRange","dynamicPadding","flex","ref","flexDirection","gap","onChange","target","placeholder","outline","onClick","marginTop","paddingTop","borderTop","checked","htmlFor","marginLeft","borderLeft","overflowY","fontStyle","_c3","$RefreshReg$"],"sources":["/Users/E113938/Library/CloudStorage/OneDrive-RMITUniversity/My Mac Folders/2025/FILTER Project/FILTER/Map Dashboard/Map Demonstrator/src/components/map.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport maplibregl from 'maplibre-gl';\nimport 'maplibre-gl/dist/maplibre-gl.css';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\nimport indicatorMetadata from './indicatorMetadata';\nimport bbox from '@turf/bbox'; // New import for bounding box calculation\n\n// --- LLM API Setup ---\nconst genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);\n\n// --- START: INTERACTIVE DESCRIPTION COMPONENT ---\n// This component finds and styles specified keywords in a block of text.\nconst InteractiveDescription = ({ text, keywords, colors, onKeywordHover }) => {\n  if (!text) return null;\n\n  // Create a regex that matches either a keyword or a bolded section.\n  const regex = new RegExp(`(${keywords.join('|')}|\\\\*\\\\*.+?\\\\*\\\\*)`, 'gi');\n  const parts = text.split(regex).filter(part => part);\n\n  return (\n    <p style={{ fontSize: '0.95rem', color: '#6c757d', lineHeight: 1.6 }}>\n      {parts.map((part, index) => {\n        // First, check if the part is a bolded section.\n        if (part.startsWith('**') && part.endsWith('**')) {\n          return <strong key={index}>{part.substring(2, part.length - 2)}</strong>;\n        }\n\n        // Next, check if the part is an interactive keyword.\n        const originalKeyword = keywords.find(kw => kw.toLowerCase() === part.toLowerCase());\n        if (originalKeyword) {\n          return (\n            <strong\n              key={index}\n              style={{\n                color: colors[originalKeyword] || '#000',\n                cursor: 'pointer',\n                fontWeight: 'bold',\n                padding: '2px 0',\n                borderBottom: `2px solid ${colors[originalKeyword] || '#000'}`\n              }}\n              onMouseEnter={() => onKeywordHover(originalKeyword)}\n              onMouseLeave={() => onKeywordHover(null)}\n            >\n              {part}\n            </strong>\n          );\n        }\n\n        // Otherwise, it's just a regular piece of text.\n        return <React.Fragment key={index}>{part}</React.Fragment>;\n      })}\n    </p>\n  );\n};\n// --- END: INTERACTIVE DESCRIPTION COMPONENT ---\n\n// --- START: LEGEND COMPONENT ---\nconst Legend = ({ title, items }) => {\n  return (\n    <div style={{\n      position: 'absolute',\n      bottom: '1rem',\n      right: '0rem',\n      backgroundColor: 'white',\n      padding: '1rem',\n      borderRadius: '0.5rem',\n      boxShadow: '0 4px 6px rgba(0,0,0,0.1)',\n      zIndex: 10,\n      width: '240px'\n    }}>\n      <h4 style={{ margin: '0 0 0.5rem 0', fontWeight: 'bold' }}>{title}</h4>\n      {items.map((item, index) => (\n        <div key={index} style={{ display: 'flex', alignItems: 'center', marginBottom: '0.25rem' }}>\n          <span style={{\n            backgroundColor: item.color,\n            width: '18px',\n            height: '18px',\n            display: 'inline-block',\n            marginRight: '0.5rem',\n            border: '1px solid #ccc'\n          }}></span>\n          <span>{item.label}</span>\n        </div>\n      ))}\n    </div>\n  );\n};\n// --- END: LEGEND COMPONENT ---\n\n\n// --- START: MAP COMPONENT ---\nexport default function Map() {\n  const mapContainer = useRef(null);\n  const map = useRef(null);\n  const descriptionCache = useRef({});\n\n  // Definitions for interactive text highlighting\n  const PRECINCT_NAMES = ['Montague', 'Sandridge', 'Lorimer', 'Wirraway', 'Employment Precinct'];\n  const PRECINCT_COLORS = {\n    'Montague': '#3498db',\n    'Sandridge': '#e74c3c',\n    'Lorimer': '#2ecc71',\n    'Wirraway': '#f39c12',\n    'Employment Precinct': '#9b59b6'\n  };\n\n  // --- STATE MANAGEMENT ---\n  const [searchText, setSearchText] = useState('');\n  const [indicators, setIndicators] = useState([]);\n  const [selectedIndicator, setSelectedIndicator] = useState(null);\n  const [showIndicators, setShowIndicators] = useState(false);\n  const [panelFocus, setPanelFocus] = useState(null);\n  const [dynamicDescription, setDynamicDescription] = useState('');\n  const [isDescriptionLoading, setIsDescriptionLoading] = useState(false);\n  const [textHoveredPrecinct, setTextHoveredPrecinct] = useState(null);\n\n  // Panel widths for map padding\n  const leftPanelWidth = 288;\n  const rightPanelWidth = 175;\n\n  // --- DATA DEFINITIONS ---\n  const legendData = {\n    'Diversity of Education Qualification': {\n      title: 'Residents with any qualification (Total)',\n      items: [ { color: '#fee5d9', label: '0 - 100' }, { color: '#fcbba1', label: '101 - 200' }, { color: '#fc9272', label: '201 - 300' }, { color: '#fb6a4a', label: '301 - 400' }, { color: '#ef3b2c', label: '401 - 500' }, { color: '#cb181d', label: '> 500' } ]\n    },\n    'Diversity of Income': {\n        title: 'Residents with any income level (Total)',\n        items: [ { color: '#fcfbfd', label: '0 - 100' }, { color: '#efedf5', label: '101 - 200' }, { color: '#dadaeb', label: '201 - 300' }, { color: '#bcbddc', label: '301 - 400' }, { color: '#9e9ac8', label: '401 - 500' }, { color: '#807dba', label: '501 - 600' }, { color: '#6a51a3', label: '601 - 700' }, { color: '#54278f', label: '701 - 800' }, { color: '#3f007d', label: '> 800' } ]\n    },\n    'Diversity of Occupations': {\n      title: 'Residents with any occupations (Total)',\n      items: [ { color: '#f7fbff', label: '0 - 100' }, { color: '#deebf7', label: '101 - 200' }, { color: '#c6dbef', label: '201 - 300' }, { color: '#9ecae1', label: '301 - 400' }, { color: '#6baed6', label: '401 - 500' }, { color: '#4292c6', label: '501 - 600' }, { color: '#2171b5', label: '601 - 700' }, { color: '#08519c', label: '701 - 800' }, { color: '#08306b', label: '> 800' } ]\n    }\n  };\n\n  const indicatorConfig = {\n    'Diversity of Education Qualification': { path: '/data/education-fb-sa1.geojson', property: 'Education-VIC_Total' },\n    'Diversity of Income': { path: '/data/income-fb-sa1.geojson', property: 'Income-VIC1_Total' },\n    'Diversity of Occupations': { path: '/data/occupation-fb-sa1.geojson', property: 'Occupation-VIC_Total' }\n  };\n\n  // --- HOOKS for Map Lifecycle & Effects ---\n\n  // Main Map Initialization\n  useEffect(() => {\n    if (map.current || !mapContainer.current) return;\n\n    map.current = new maplibregl.Map({\n      container: mapContainer.current,\n      style: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',\n      scrollZoom: false, boxZoom: false, dragRotate: false, dragPan: false,\n      keyboard: false, doubleClickZoom: false, touchZoomRotate: false,\n    });\n\n    map.current.on('error', (e) => console.error('A map error occurred:', e.error ? e.error.message : 'Unknown error'));\n\n    map.current.on('load', () => {\n      adjustMapBounds();\n\n      const sources = [\n        { name: 'base-outline', path: '/data/fb-sa1-2021-WGS84-boundary.geojson' },\n        { name: 'employment', path: '/data/employment-fb-sa1.geojson' },\n        { name: 'education', path: '/data/education-fb-sa1.geojson' },\n        { name: 'pob', path: '/data/POB-fb-sa1.geojson' },\n        { name: 'income', path: '/data/income-fb-sa1.geojson' },\n        { name: 'occupation', path: '/data/occupation-fb-sa1.geojson' },\n        { name: 'precincts', path: '/data/fb-precincts-official-boundary.geojson' },\n      ];\n      sources.forEach(s => map.current.addSource(`${s.name}-data-source`, { type: 'geojson', data: s.path }));\n\n      const layers = [\n        { id: 'diversity-of-education-qualification-layer', indicatorName: 'Diversity of Education Qualification', source: 'education-data-source', property: indicatorConfig['Diversity of Education Qualification'].property, colors: legendData['Diversity of Education Qualification'].items.map(i => i.color), stops: [0, 100, 200, 300, 400, 500]  },\n        { id: 'diversity-of-income-layer', indicatorName: 'Diversity of Income', source: 'income-data-source', property: indicatorConfig['Diversity of Income'].property, colors: legendData['Diversity of Income'].items.map(i => i.color), stops: [0, 100, 200, 300, 400, 500, 600, 700, 800] },\n        { id: 'diversity-of-occupations-layer', indicatorName: 'Diversity of Occupations', source: 'occupation-data-source', property: indicatorConfig['Diversity of Occupations'].property, colors: legendData['Diversity of Occupations'].items.map(i => i.color), stops: [0, 100, 200, 300, 400, 500, 600, 700, 800] }\n      ];\n\n      layers.forEach(layer => {\n        const colorStops = layer.stops.flatMap((stop, i) => [stop, layer.colors[i] || layer.colors[layer.colors.length - 1]]);\n        map.current.addLayer({\n          id: layer.id, type: 'fill', source: layer.source, layout: { visibility: 'none' },\n          paint: { 'fill-color': ['interpolate', ['linear'], ['to-number', ['get', layer.property]], ...colorStops], 'fill-opacity': 0.6 }\n        });\n        map.current.on('click', layer.id, (e) => {\n          const feature = e.features[0];\n          if (feature) {\n            const regionName = feature.properties['SA1_CODE21'];\n            const value = feature.properties[layer.property];\n            const formattedValue = !isNaN(value) ? Number(value).toLocaleString() : 'N/A';\n          }\n        });\n        map.current.on('mouseenter', layer.id, () => { map.current.getCanvas().style.cursor = 'pointer'; });\n        map.current.on('mouseleave', layer.id, () => { map.current.getCanvas().style.cursor = ''; });\n      });\n\n      map.current.addLayer({\n        id: 'base-outline-layer', type: 'line', source: 'base-outline-data-source',\n        paint: { 'line-color': '#444', 'line-width': 0.2 }\n      });\n      \n      map.current.addLayer({\n        id: 'precincts-fill-layer', type: 'fill', source: 'precincts-data-source',\n        paint: { 'fill-color': '#ffffffff', 'fill-opacity': 0.15 }\n      });\n      map.current.addLayer({\n        id: 'precincts-shadow-layer', type: 'line', source: 'precincts-data-source',\n        paint: { 'line-color': 'rgba(0, 0, 0, 0.4)', 'line-width': 7, 'line-translate': [2, 2], 'line-blur': 4 }\n      });\n      map.current.addLayer({\n          id: 'precincts-outline-layer', type: 'line', source: 'precincts-data-source',\n          paint: { 'line-color': '#0868ac', 'line-width': 2.5, 'line-opacity': 0.9 }\n      });\n\n      map.current.on('click', 'precincts-fill-layer', (e) => {\n        const feature = e.features[0];\n        if (!feature || !feature.properties.name) return;\n        const precinctName = feature.properties.name;\n        setPanelFocus({ type: 'precinct', name: precinctName });\n        setTextHoveredPrecinct(null);\n      });\n\n      map.current.on('mouseenter', 'precincts-fill-layer', () => { map.current.getCanvas().style.cursor = 'pointer'; });\n      map.current.on('mouseleave', 'precincts-fill-layer', () => { map.current.getCanvas().style.cursor = ''; });\n    });\n\n    return () => { if (map.current) { map.current.remove(); map.current = null; } };\n  }, []);\n\n  // UPDATED: Adjust map bounds on load (and for resets)\n  const adjustMapBounds = (duration = 2000) => {\n    if (!map.current) return;\n    const bounds = [ [144.890, -37.850], [144.948, -37.816] ];\n    map.current.fitBounds(bounds, {\n      padding: { top: 20, bottom: 20, left: leftPanelWidth, right: rightPanelWidth },\n      duration: duration,\n      essential: true\n    });\n  };\n\n  // UPDATED: Adjust map bounds on window resize\n  useEffect(() => {\n    function debounce(fn, ms) {\n      let timer;\n      return function(...args) { clearTimeout(timer); timer = setTimeout(() => { fn.apply(this, args); }, ms); };\n    }\n    const debouncedAdjustBounds = () => {\n      adjustMapBounds(0); // Pass 0 for an instant adjustment\n    };\n    const debouncedResizeListener = debounce(debouncedAdjustBounds, 150);\n    window.addEventListener('resize', debouncedResizeListener);\n    return () => window.removeEventListener('resize', debouncedResizeListener);\n  }, []);\n\n  // Toggle visibility of indicator layers\n  useEffect(() => {\n    if (!map.current || !map.current.isStyleLoaded()) return;\n    const allLayerIds = [\n        'diversity-of-education-qualification-layer', \n        'diversity-of-income-layer', \n        'diversity-of-occupations-layer'\n    ];\n    const selectedLayerId = selectedIndicator ? `${selectedIndicator.toLowerCase().replace(/ /g, '-')}-layer` : null;\n\n    if (map.current.getLayer('base-outline-layer')) {\n        map.current.setLayoutProperty('base-outline-layer', 'visibility', selectedIndicator ? 'visible' : 'none');\n    }\n\n    allLayerIds.forEach(layerId => {\n      if (map.current.getLayer(layerId)) {\n        map.current.setLayoutProperty(layerId, 'visibility', layerId === selectedLayerId ? 'visible' : 'none');\n      }\n    });\n  }, [selectedIndicator]);\n\n  // Generate LLM description when panel focus changes\n  useEffect(() => {\n    if (!panelFocus) {\n      setDynamicDescription('');\n      setIsDescriptionLoading(false);\n      return;\n    }\n\n    const generateDescription = async () => {\n        setIsDescriptionLoading(true);\n        setDynamicDescription('');\n        const { type, name } = panelFocus;\n        const cacheKey = `${type}_${name}`;\n\n        if (descriptionCache.current[cacheKey]) {\n            setDynamicDescription(descriptionCache.current[cacheKey]);\n            setIsDescriptionLoading(false);\n            return;\n        }\n\n        try {\n            let prompt = '';\n            if (type === 'indicator') {\n                const metadata = indicatorMetadata[name];\n\n                if (!metadata) {\n                    throw new Error(`Metadata is missing for the \"${name}\" indicator.`);\n                }\n                \n                prompt = `You are an expert urban data analyst providing a summary for a public-facing dashboard about Melbourne's Fishermans Bend.\nYour task is to generate a clear, descriptive summary for the \"${name}\" indicator based ONLY on the metadata provided below.\n\nUse the following information to structure your response. Present it as a cohesive and easy-to-read paragraph, not as a list. **Crucially, when you incorporate a piece of metadata from the list below into your paragraph, you must make that specific value bold using Markdown (e.g., the goal is **An inclusive community**).**\n\n- **Alignment with Goals**: This indicator aligns with Fishermans Bend's goal of: \"${metadata[\"FB's goals\"]}\".\n- **Measurement Method**: It is measured by this method: \"${metadata[\"Note for measurement\"]}\".\n- **Data Origin**: The data is sourced from \"${metadata[\"Data sources\"]}\".\n- **Geographic Coverage**: The data's spatial extent is \"${metadata[\"Spatial extent\"]}\", presented at a \"${metadata[\"Spatial scale\"]}\" level.\n- **Timeliness**: The data is updated every \"${metadata[\"Update frequency\"]}\". The current version is from \"${metadata[\"Temporal currency\"]}\", and the historical data available covers the period \"${metadata[\"Temporal extent\"]}\".\n\nSynthesize this information into an engaging and informative paragraph of about 70-100 words. Start by explaining what this indicator is and why it's important for Fishermans Bend's goals. Then, provide context about the data itself. Remember to make all the specific metadata values bold in your final output. Do not invent or infer any data values, statistics, or trends.`;\n\n            } else if (type === 'precinct') {\n                prompt = `You are a concise urban planning analyst. Write a short, engaging summary (around 60-80 words) about the \"${name}\" precinct within Melbourne's Fishermans Bend. Describe its key vision or main characteristics. If relevant, mention its relationship to the other precincts like Montague, Sandridge, and the Employment Precinct.`;\n            }\n\n            if (prompt) {\n                const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash-latest\" });\n                const result = await model.generateContent(prompt);\n                const text = result.response.text();\n                descriptionCache.current[cacheKey] = text;\n                setDynamicDescription(text);\n            }\n        } catch (error) {\n            console.error(`Error generating description for ${name}:`, error);\n            const errorMessage = error.message.includes('429')\n                ? 'Daily free API quota exceeded. Please try again tomorrow or upgrade to a paid plan.'\n                : `An error occurred while generating the description: ${error.message}`;\n            setDynamicDescription(errorMessage);\n        } finally {\n            setIsDescriptionLoading(false);\n        }\n    };\n    generateDescription();\n  }, [panelFocus]);\n\n  // Update map visual style when a precinct is highlighted from text\n  useEffect(() => {\n    if (!map.current || !map.current.isStyleLoaded()) return;\n\n    if (textHoveredPrecinct) {\n      const fillColorExpression = [ 'case', ['==', ['get', 'name'], textHoveredPrecinct], PRECINCT_COLORS[textHoveredPrecinct], '#ffffffff' ];\n      const fillOpacityExpression = [ 'case', ['==', ['get', 'name'], textHoveredPrecinct], 0.6, 0.15 ];\n      const outlineColorExpression = [ 'case', ['==', ['get', 'name'], textHoveredPrecinct], PRECINCT_COLORS[textHoveredPrecinct], '#0868ac' ];\n\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-color', fillColorExpression);\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-opacity', fillOpacityExpression);\n      map.current.setPaintProperty('precincts-outline-layer', 'line-color', outlineColorExpression);\n\n    } else {\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-color', '#ffffffff');\n      map.current.setPaintProperty('precincts-fill-layer', 'fill-opacity', 0.15);\n      map.current.setPaintProperty('precincts-outline-layer', 'line-color', '#0868ac');\n    }\n  }, [textHoveredPrecinct, PRECINCT_COLORS]);\n\n  // --- UI HANDLERS ---\n  const handleSearchClick = () => {\n    setIndicators(['Diversity of Education Qualification', 'Diversity of Income', 'Diversity of Occupations']);\n    setShowIndicators(true);\n  };\n  \n  // UPDATED: Handles selecting/deselecting indicators and resets map view\n  const handleIndicatorSelect = (indicator) => {\n    const isCurrentlySelected = selectedIndicator === indicator;\n    const newIndicator = isCurrentlySelected ? null : indicator;\n\n    // If an indicator is being deselected, reset the map view\n    if (!newIndicator) {\n      adjustMapBounds(800);\n    }\n    \n    setSelectedIndicator(newIndicator);\n    setPanelFocus(newIndicator ? { type: 'indicator', name: newIndicator } : null);\n    setTextHoveredPrecinct(null);\n  };\n\n  // UPDATED: Handles zooming the map on text hover\n  const handlePrecinctHover = (precinctName) => {\n    setTextHoveredPrecinct(precinctName);\n\n    if (!map.current || !map.current.isStyleLoaded()) return;\n\n    // If hovering OVER a precinct name (onMouseEnter)\n    if (precinctName) {\n      const features = map.current.querySourceFeatures('precincts-data-source', {\n        filter: ['==', ['get', 'name'], precinctName]\n      });\n\n      if (features.length > 0) {\n        const feature = features[0];\n        const precinctBbox = bbox(feature); // Gets the hovered precinct's bounding box\n\n        // --- Start of Dynamic Padding Calculation ---\n\n        // 1. Define the overall map bounds and desired padding range in pixels.\n        //    You can tweak min/max padding to adjust the zoom \"feel\".\n        const fullMapBbox = [144.890, -37.850, 144.948, -37.816];\n        const minPadding = 40;  // Padding for the largest precincts (e.g., Employment Precinct).\n        const maxPadding = 150; // Padding for the smallest precincts (e.g., Lorimer).\n\n        // 2. Calculate the dimensions of the precinct and the full map view.\n        const precinctWidth = precinctBbox[2] - precinctBbox[0];\n        const precinctHeight = precinctBbox[3] - precinctBbox[1];\n        const fullMapWidth = fullMapBbox[2] - fullMapBbox[0];\n        const fullMapHeight = fullMapBbox[3] - fullMapBbox[1];\n\n        // 3. Determine how large the precinct is relative to the full map.\n        //    We use the larger of its two dimensions (width or height) for the calculation.\n        const widthRatio = precinctWidth / fullMapWidth;\n        const heightRatio = precinctHeight / fullMapHeight;\n        const maxRatio = Math.max(widthRatio, heightRatio);\n\n        // 4. Calculate the dynamic padding. A larger precinct (higher maxRatio) gets less padding.\n        //    This formula scales the padding inversely with the precinct's relative size.\n        const paddingRange = maxPadding - minPadding;\n        let dynamicPadding = maxPadding - (maxRatio * paddingRange);\n        \n        // 5. Ensure the calculated padding doesn't go below our defined minimum.\n        dynamicPadding = Math.max(dynamicPadding, minPadding);\n\n        // --- End of Dynamic Padding Calculation ---\n\n        // Animate the map to fit the precinct's bounding box with the new dynamic padding\n        map.current.fitBounds(precinctBbox, {\n          padding: {\n            top: dynamicPadding,\n            bottom: dynamicPadding,\n            left: leftPanelWidth + dynamicPadding, // Adds panel width to our dynamic padding\n            right: rightPanelWidth + dynamicPadding // Adds panel width to our dynamic padding\n          },\n          duration: 800,\n          essential: true\n        });\n      }\n    } else {\n      // If the mouse LEAVES the text (onMouseLeave), reset the map's view\n      adjustMapBounds(800);\n    }\n  };\n\n  // --- RENDER METHOD ---\n  return (\n    <div style={{ display: 'flex', width: '100%', height: 'calc(100vh - 78px)' }}>\n      {/* Map container */}\n      <div style={{ position: 'relative', flex: 1 }}>\n        <div ref={mapContainer} style={{ position: 'absolute', width: '100%', height: '100%' }} />\n        <div style={{ position: 'absolute', top: '1rem', left: '1rem', backgroundColor: 'white', padding: '1rem', borderRadius: '0.5rem', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', width: '288px', zIndex: 10 }}>\n          <h3 style={{ fontSize: '1.125rem', fontWeight: 'bold', marginBottom: '1rem' }}>I'm interested in ...</h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\n            <input type=\"text\" value={searchText} onChange={(e) => setSearchText(e.target.value)} placeholder=\"e.g., 'jobs' or 'housing'\" style={{ padding: '0.5rem', border: '1px solid #D1D5DB', borderRadius: '0.375rem', outline: 'none' }} />\n            <button onClick={handleSearchClick} style={{ backgroundColor: '#2563EB', color: 'white', fontWeight: 600, padding: '0.5rem 1rem', borderRadius: '0.375rem', border: 'none', cursor: 'pointer' }}>Search</button>\n          </div>\n          {showIndicators && (\n            <div style={{ marginTop: '1rem', paddingTop: '1rem', borderTop: '1px solid #E5E7EB' }}>\n              <h4 style={{ fontWeight: 600, color: '#1F2937', marginBottom: '0.5rem' }}>Suggested Indicators</h4>\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\n                {indicators.map((indicator) => (\n                  <div key={indicator} style={{ display: 'flex', alignItems: 'center' }}>\n                    <input type=\"radio\" id={indicator} name=\"indicator\" checked={selectedIndicator === indicator} onChange={() => handleIndicatorSelect(indicator)} style={{ height: '1rem', width: '1rem' }} />\n                    <label htmlFor={indicator} style={{ marginLeft: '0.75rem', fontSize: '0.875rem', color: '#374151' }}>{indicator}</label>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n        {selectedIndicator && legendData[selectedIndicator] && <Legend title={legendData[selectedIndicator].title} items={legendData[selectedIndicator].items} />}\n      </div>\n      {/* Text Explorer Panel */}\n      <div style={{ width: '320px', backgroundColor: '#f8f9fa', padding: '1.5rem', borderLeft: '1px solid #dee2e6', overflowY: 'auto' }}>\n        {panelFocus ? (\n          <div>\n            <h4 style={{ fontSize: '1.1rem', fontWeight: 600, color: '#495057', marginBottom: '0.75rem' }}>{panelFocus.name}</h4>\n            {isDescriptionLoading ? (\n              <p style={{ fontSize: '0.95rem', color: '#6c757d', fontStyle: 'italic' }}> Generating AI description...</p>\n            ) : (\n              <InteractiveDescription\n                text={dynamicDescription}\n                keywords={PRECINCT_NAMES}\n                colors={PRECINCT_COLORS}\n                onKeywordHover={handlePrecinctHover}\n              />\n            )}\n          </div>\n        ) : (\n          <p style={{ fontSize: '0.95rem', color: '#6c757d', fontStyle: 'italic' }}>Select an indicator from the left panel or click on a precinct on the map to see its description.</p>\n        )}\n      </div>\n    </div>\n  );\n}\n// --- END: MAP COMPONENT ---"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}